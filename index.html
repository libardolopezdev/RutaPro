<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RutaApp - Registro Diario</title>
    <meta name="description" content="Registra tus carreras, gastos y ganancias diarias como conductor de plataforma.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <!-- ===== PANTALLA DE LOGIN ===== -->
    <div id="loginScreen">
        <div class="login-card">
            <div class="login-logo">üöñ</div>
            <h1 class="login-title">RutaApp</h1>
            <p class="login-subtitle" id="authSubtitle">Inicia sesi√≥n en tu cuenta</p>

            <!-- Mensaje de error -->
            <div class="auth-error" id="authError" style="display: none;"></div>

            <input type="email" class="login-input" id="loginEmail" placeholder="Correo electr√≥nico"
                autocomplete="username">
            <input type="password" class="login-input" id="loginPassword" placeholder="Contrase√±a"
                autocomplete="current-password">

            <!-- Bot√≥n Login (visible por defecto) -->
            <button class="login-btn primary" id="btnLogin" onclick="handleLogin()">Iniciar sesi√≥n</button>
            <!-- Bot√≥n Registro (oculto por defecto) -->
            <button class="login-btn secondary" id="btnRegister" onclick="handleRegister()" style="display: none;">Crear
                cuenta</button>

            <!-- Separador -->
            <div style="display: flex; align-items: center; gap: 10px; margin: 4px 0;">
                <div style="flex: 1; height: 1px; background: rgba(255,255,255,0.3);"></div>
                <span style="font-size: 12px; opacity: 0.7;">o</span>
                <div style="flex: 1; height: 1px; background: rgba(255,255,255,0.3);"></div>
            </div>

            <!-- Bot√≥n Google -->
            <button class="login-btn google" id="btnGoogle" onclick="handleGoogleLogin()">
                <svg width="18" height="18" viewBox="0 0 48 48" style="margin-right: 8px; flex-shrink: 0;">
                    <path fill="#FFC107"
                        d="M43.6 20.5H42V20H24v8h11.3C33.7 32.6 29.2 35 24 35c-6.1 0-11-4.9-11-11s4.9-11 11-11c2.8 0 5.3 1 7.2 2.7l5.7-5.7C33.3 7.3 28.9 5.5 24 5.5 13.2 5.5 4.5 14.2 4.5 25S13.2 44.5 24 44.5C34.8 44.5 43.5 35.8 43.5 25c0-1.5-.2-3-.4-4.5z" />
                    <path fill="#FF3D00"
                        d="M6.3 14.7l6.6 4.8C14.5 16.1 19 13 24 13c2.8 0 5.3 1 7.2 2.7l5.7-5.7C33.3 7.3 28.9 5.5 24 5.5c-7.7 0-14.4 4.4-17.7 10.2z" />
                    <path fill="#4CAF50"
                        d="M24 44.5c4.8 0 9.1-1.7 12.4-4.5l-6.2-5.1C28.4 36.3 26.3 37 24 37c-5.1 0-9.6-3.4-11.2-8l-6.6 5C9.6 40.1 16.3 44.5 24 44.5z" />
                    <path fill="#1976D2"
                        d="M43.6 20.5H42V20H24v8h11.3c-.8 2.2-2.2 4.1-4 5.5l6.2 5.1C37.5 38.8 43.5 33 43.5 25c0-1.5-.2-3-.4-4.5z" />
                </svg>
                Continuar con Google
            </button>

            <div class="login-toggle">
                <a id="toggleAuthMode" onclick="toggleAuthMode()">¬øNo tienes cuenta? Reg√≠strate</a>
            </div>

        </div>
    </div>


    <!-- ===== CONTENEDOR PRINCIPAL (oculto hasta login) ===== -->
    <div id="appContainer" style="display: none;">
        <div class="container">

            <!-- ===== HEADER ===== -->
            <header class="header"
                style="background: linear-gradient(135deg, #134e5e 0%, #71b280 100%); padding: 20px; border-radius: 0;">

                <!-- Fila superior: √≠conos -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">

                    <!-- Izquierda: estado de conexi√≥n -->
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <span id="connectionStatus" title="Sincronizado" style="font-size:18px;">‚òÅÔ∏è</span>
                        <span id="userEmail"
                            style="color: rgba(255,255,255,0.82); font-size:11px; font-weight:600;"></span>
                    </div>

                    <!-- Derecha: hist√≥rico, config, logout -->
                    <div style="display: flex; gap: 6px; align-items: center;">
                        <button class="header-icon-btn" id="historicoBtn" aria-label="Hist√≥rico">
                            <span class="ms">bar_chart</span>
                        </button>
                        <button class="header-icon-btn" id="settingsBtn" aria-label="Configuraci√≥n">
                            <span class="ms">settings</span>
                        </button>
                        <button class="header-icon-btn danger" id="logoutBtn" aria-label="Cerrar sesi√≥n">
                            <span class="ms">logout</span>
                        </button>
                    </div>
                </div>

                <!-- Fecha -->
                <div class="date-display" style="font-size: 13px; margin-bottom: 20px; font-weight: 500; opacity: 0.95;"
                    id="currentDate"></div>

                <!-- Card de meta -->
                <div style="background: rgba(255,255,255,0.15); padding: 20px; border-radius: 16px;
                        backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.2);
                        box-shadow: 0 8px 32px rgba(0,0,0,0.1);">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <div style="font-size: 11px; font-weight: 600; opacity: 0.8; margin-bottom: 5px;
                                    text-transform: uppercase; letter-spacing: 0.5px;">üéØ Meta</div>
                            <div style="font-size: 22px; font-weight: 700;" id="metaDisplay">$270.000</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 11px; font-weight: 600; opacity: 0.8; margin-bottom: 5px;
                                    text-transform: uppercase; letter-spacing: 0.5px;">üí∞ Alcanzado</div>
                            <div style="display: flex; align-items: baseline; justify-content: flex-end; gap: 6px;">
                                <span style="font-size: 22px; font-weight: 700;" id="alcanzadoDisplay">$0</span>
                                <span style="font-size: 13px; font-weight: 600; opacity: 0.85;">
                                    <span id="porcentajeDisplay">0</span>%
                                </span>
                            </div>
                        </div>
                    </div>

                    <div style="height: 8px; background: rgba(0,0,0,0.15); border-radius: 10px; overflow: hidden;
                            margin-bottom: 12px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
                        <div class="progress-fill-meta" id="progressFillMeta"
                            style="height: 100%; width: 0%; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);"></div>
                    </div>

                    <div style="text-align: center; margin-top: 8px;">
                        <!-- Badge destacado de "Faltan" -->

                        <div id="faltaBadge" style="
                                display: inline-block; margin-top: 10px;
                                background: rgba(255,255,255,0.22);
                                border: 2px solid rgba(255,255,255,0.55);
                                border-radius: 12px; padding: 10px 20px;
                                backdrop-filter: blur(10px);
                                box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                            ">
                            <div style="font-size: 10px; font-weight: 700; opacity: 0.8;
                                           text-transform: uppercase; letter-spacing: 0.8px;
                                           margin-bottom: 4px;">
                                üéØ Te faltan
                            </div>
                            <div id="faltaBadgeValor" style="
                                    font-size: 26px; font-weight: 900;
                                    letter-spacing: -1px;
                                    text-shadow: 0 2px 8px rgba(0,0,0,0.2);
                                ">$270.000</div>
                        </div>
                    </div>

                    <div style="display: none; margin-top: 12px; padding: 12px;
                                background: linear-gradient(135deg, rgba(113,178,128,0.3), rgba(90,170,153,0.3));
                                border-radius: 10px; border: 2px solid rgba(113,178,128,0.6);
                                box-shadow: 0 4px 12px rgba(113,178,128,0.2);" id="excedenteDisplay">
                        <div
                            style="font-size: 12px; font-weight: 700; margin-bottom: 4px; color: rgba(255,255,255,0.95);">
                            üéâ ¬°Meta Superada!
                        </div>
                        <div
                            style="font-size: 16px; font-weight: 800; color: #ffffff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">
                            +<span id="excedenteValor">$0</span> ‚≠ê
                        </div>
                    </div>
                </div>
            </header>


            <!-- ===== SECCI√ìN HIST√ìRICO ===== -->
            <section class="historico-section" style="display: none;" id="historicoSection">
                <div style="padding: 15px; background: var(--light-color); border-bottom: 1px solid #e0e0e0;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3>üìä Hist√≥rico</h3>
                        <button class="platform-btn"
                            style="background: var(--danger-color); padding: 6px 12px; font-size: 12px;"
                            onclick="closeHistorico()">‚úï</button>
                    </div>

                    <div style="display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button class="historico-btn active" onclick="filterHistorico('dia')"
                            data-filter="dia">D√≠a</button>
                        <button class="historico-btn" onclick="filterHistorico('semana')"
                            data-filter="semana">Semana</button>
                        <button class="historico-btn" onclick="filterHistorico('mes')" data-filter="mes">Mes</button>
                        <button class="historico-btn" onclick="filterHistorico('ano')" data-filter="ano">A√±o</button>
                        <button class="historico-btn" onclick="filterHistorico('rango')" data-filter="rango">üìÖ
                            Rango</button>
                    </div>

                    <div id="rangoFechas"
                        style="display: none; background: white; padding: 12px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <div>
                                <label
                                    style="font-size: 11px; font-weight: bold; display: block; margin-bottom: 4px;">Desde:</label>
                                <input type="date" id="fechaDesde"
                                    style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                            </div>
                            <div>
                                <label
                                    style="font-size: 11px; font-weight: bold; display: block; margin-bottom: 4px;">Hasta:</label>
                                <input type="date" id="fechaHasta"
                                    style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px;">
                            </div>
                        </div>
                        <button onclick="aplicarRangoFechas()" style="width: 100%; padding: 8px; background: var(--primary-color); color: white;
                               border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">Aplicar</button>
                    </div>

                    <div id="historicoContent"></div>

                    <div id="historicoResumen"
                        style="display: none; margin-top: 15px; padding: 12px; background: white; border-radius: 8px;">
                        <h4
                            style="font-size: 13px; font-weight: bold; margin-bottom: 10px; color: var(--primary-color);">
                            üìä Resumen del Per√≠odo
                        </h4>
                        <div id="historicoResumenStats" style="font-size: 12px;"></div>
                        <button onclick="compartirHistorico()" style="width: 100%; margin-top: 10px; padding: 10px; background: var(--secondary-color);
                               color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;">
                            üì§ Compartir Resumen
                        </button>
                    </div>
                </div>
            </section>

            <!-- ===== CONTROL DE JORNADA ===== -->
            <section class="jornada-control">
                <button class="jornada-btn" id="jornadaBtn">INICIAR JORNADA</button>
                <div class="jornada-info" id="jornadaInfo">Presiona para comenzar tu d√≠a de trabajo</div>
            </section>

            <!-- ===== CONTENIDO PRINCIPAL ===== -->
            <div id="appContent" class="app-disabled">

                <!-- Consolidados -->
                <section class="consolidados" aria-labelledby="consolidados-title">
                    <h2 id="consolidados-title" class="visually-hidden">Consolidados</h2>
                    <div class="consolidados-grid" style="gap: 10px; margin-bottom: 10px;">
                        <div class="consolidado-item" style="background: #e8f5f0;">
                            <div class="consolidado-value" id="gananciaEfectivo" style="color: #134e5e;">$0</div>
                            <div class="consolidado-label" style="color: #2c5f5f;">GANANCIA EFECTIVO</div>
                        </div>
                        <div class="consolidado-item" style="background: #d1f2eb;">
                            <div class="consolidado-value" id="gananciaDigital" style="color: #16a085;">$0</div>
                            <div class="consolidado-label" style="color: #138d75;">GANANCIA DIGITAL</div>
                        </div>
                    </div>
                    <div class="consolidados-grid" style="grid-template-columns: 1fr; gap: 10px;">
                        <div class="consolidado-item" style="background: #e8f5e8; border: 2px solid #2e7d32;">
                            <div class="consolidado-value" id="consolidadoNeto"
                                style="color: #2e7d32; font-size: 24px;">$0
                            </div>
                            <div class="consolidado-label" style="color: #2e7d32; font-weight: bold;">TOTAL NETO</div>
                        </div>
                    </div>
                </section>

                <!-- Formulario de carrera -->
                <main class="quick-add">
                    <div class="input-group">
                        <input type="text" inputmode="numeric" class="amount-input" id="amountInput"
                            placeholder="Valor Carrera" autocomplete="off" aria-label="Valor de la carrera">
                    </div>



                    <fieldset class="section">
                        <legend class="section-title">Selecciona la plataforma:</legend>
                        <div class="platform-buttons" id="platformButtonsContainer">
                            <!-- Generado din√°micamente por renderPlatformButtons() en ui.js -->
                        </div>

                    </fieldset>

                    <fieldset class="section">
                        <legend class="section-title">M√©todo de pago:</legend>
                        <div class="payment-buttons" id="paymentButtons">
                            <button class="payment-btn efectivo" data-payment="efectivo">EFECTIVO</button>
                            <button class="payment-btn tarjeta" data-payment="tarjeta">TARJETA</button>
                            <button class="payment-btn vale" data-payment="vale">VALE</button>
                            <button class="payment-btn transferencia"
                                data-payment="transferencia">TRANSFERENCIA</button>
                        </div>
                    </fieldset>

                    <button class="add-btn" id="addCarrera" disabled>AGREGAR CARRERA</button>
                </main>

                <!-- Gastos -->
                <section class="gastos-section" aria-labelledby="gastos-title">
                    <h3 id="gastos-title"
                        style="font-size: 14px; font-weight: bold; color: var(--dark-color); margin-bottom: 10px;">
                        üí∏ Gastos del D√≠a
                    </h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px;">
                        <input type="number" id="gastoMonto" placeholder="Monto"
                            style="flex: 1 1 100%; min-width: 120px; padding: 10px; border: 2px solid #ffc107; border-radius: 8px; font-size: 14px;">
                        <select id="gastoTipo"
                            style="flex: 1 1 100%; min-width: 120px; padding: 10px; border: 2px solid #ffc107; border-radius: 8px; font-size: 14px;">
                            <option value="">Tipo de gasto</option>
                            <option value="combustible">‚õΩ Combustible</option>
                            <option value="peaje">üöß Peaje</option>
                            <option value="comida">üçî Comida</option>
                            <option value="mantenimiento">üîß Mantenimiento</option>
                            <option value="ajuste">üìù Ajuste</option>
                            <option value="otro">üì¶ Otro</option>
                        </select>
                    </div>
                    <button id="agregarGasto" style="width: 100%; padding: 10px; background: #ffc107; color: #000; border: none;
                           border-radius: 8px; font-weight: bold; cursor: pointer;" disabled>AGREGAR GASTO</button>
                    <div id="listaGastos" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
                    <div
                        style="margin-top: 10px; padding: 10px; background: #fff; border-radius: 8px; border: 2px solid #ffc107;">
                        <div style="display: flex; justify-content: space-between; font-weight: bold;">
                            <span>Total Gastos:</span>
                            <span id="totalGastos" style="color: #f39c12;">$0</span>
                        </div>
                    </div>
                </section>

                <!-- Resumen del D√≠a -->
                <section class="summary" aria-labelledby="summary-title">
                    <div class="summary-header">
                        <h3 id="summary-title">Resumen del D√≠a</h3>
                        <div class="carreras-count" id="carrerasCount">0 carreras</div>
                    </div>
                    <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"
                        aria-valuenow="0">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="summary-grid">
                        <div class="summary-item" style="grid-column: span 2;">
                            <div class="summary-value" id="totalBruto">$0</div>
                            <div class="summary-label">Total Bruto</div>
                        </div>
                    </div>

                    <div style="margin-top: 15px;">
                        <h4 style="font-size: 14px; font-weight: bold; color: var(--dark-color); margin-bottom: 10px;">
                            üìä Resumen por Plataforma
                        </h4>
                        <div class="plataformas-stats" id="plataformasStats"></div>
                    </div>
                    <div style="margin-top: 15px;">
                        <h4 style="font-size: 14px; font-weight: bold; color: var(--dark-color); margin-bottom: 10px;">
                            üìã Detalle de Carreras
                        </h4>
                        <div class="carreras-list" id="carrerasList"></div>
                    </div>
                </section>

                <!-- Controles Finales -->
                <section class="final-controls" aria-labelledby="final-controls-title">
                    <h3 id="final-controls-title" class="visually-hidden">Controles Finales</h3>
                    <div class="final-summary" id="finalSummary">
                        <div class="final-row"><span>Total Bruto:</span> <span id="finalBruto">$0</span></div>
                        <div class="final-row"><span>Total Neto:</span> <span id="finalMeta">$0</span></div>
                        <div class="final-row total"><span>Adicionales:</span> <span id="finalAdicionales">$0</span>
                        </div>
                    </div>
                    <div class="export-controls">
                        <button class="export-btn" id="exportBtn">EXPORTAR D√çA</button>
                        <button class="clear-btn" id="clearBtn">LIMPIAR TODO</button>
                    </div>
                </section>

            </div><!-- /#appContent -->
        </div><!-- /.container -->
    </div><!-- /#appContainer -->


    <div class="modal" id="settingsModal" role="dialog" aria-labelledby="settings-modal-title" aria-modal="true">
        <div class="modal-content" style="max-height:88vh; overflow-y:auto;">
            <h3 id="settings-modal-title">‚öôÔ∏è Configuraci√≥n</h3>

            <!-- Meta diaria -->
            <div style="margin-bottom: 20px;">
                <label for="metaInput" style="display: block; font-size: 12px; font-weight: 700; color: var(--gray-500);
                           margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.6px;">
                    üéØ Meta Diaria
                </label>
                <input type="number" class="modal-input" id="metaInput" placeholder="Ej: 270000" min="0"
                    aria-label="Meta diaria">
            </div>

            <!-- Gesti√≥n de plataformas -->
            <div style="margin-bottom: 20px;">
                <div style="font-size: 12px; font-weight: 700; color: var(--gray-500);
                            text-transform: uppercase; letter-spacing: 0.6px; margin-bottom: 10px;">
                    üöÄ Plataformas
                </div>

                <!-- Lista de plataformas existentes -->
                <div id="platformManagerList"></div>

                <!-- Formulario para agregar nueva -->
                <div style="display: flex; gap: 8px; align-items: center; margin-top: 10px;
                            padding: 10px; background: var(--bg); border-radius: 12px;
                            border: 1.5px dashed var(--gray-300);">
                    <input type="text" id="newPlatformName" placeholder="Nombre" maxlength="14" style="flex: 1; padding: 9px 12px; border: 1.5px solid var(--gray-200);
                               border-radius: 8px; font-size: 13px; font-family: var(--font);
                               font-weight: 600; text-transform: uppercase;">
                    <input type="color" id="newPlatformColor" value="#71b280" title="Color de la plataforma" style="width: 38px; height: 38px; border: none; border-radius: 8px;
                               cursor: pointer; padding: 2px; background: none;">
                    <button onclick="addPlatform()" style="background: var(--brand); color: white; border: none;
                               border-radius: 8px; padding: 9px 14px; cursor: pointer;
                               font-size: 18px; font-weight: bold; line-height: 1;">+</button>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn cancel" id="cancelSettings">Cancelar</button>
                <button class="modal-btn save" id="saveSettings">Guardar</button>
            </div>
        </div>
    </div>



    <!-- ===== MODAL: RESUMEN FINAL ===== -->
    <div class="modal" id="resumenModal" role="dialog" aria-labelledby="resumen-modal-title" aria-modal="true">
        <div class="modal-content resumen-modal">
            <div class="resumen-header" style="display: flex; justify-content: space-between; align-items: center;
                       background: linear-gradient(135deg, #134e5e, #71b280); padding: 20px;
                       margin: -20px -20px 20px -20px; border-radius: 16px 16px 0 0; color: white;">
                <div>
                    <h3 id="resumen-modal-title" style="margin: 0 0 5px 0;">üìä Resumen Final de Jornada</h3>
                    <p id="resumenFecha" style="margin: 0; font-size: 12px; opacity: 0.9;"></p>
                </div>
                <button onclick="closeResumenModal()"
                    style="background: rgba(255,255,255,0.2); border: none; color: white;
                           width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 18px; flex-shrink: 0;">
                    ‚úï
                </button>
            </div>
            <div class="resumen-section">
                <h4>‚è∞ Tiempo de Trabajo</h4>
                <div class="resumen-detail"><span>Inicio:</span> <span id="resumenInicio"></span></div>
                <div class="resumen-detail"><span>Cierre:</span> <span id="resumenCierre"></span></div>
                <div class="resumen-detail"><span>Duraci√≥n:</span> <span id="resumenDuracion"></span></div>
            </div>
            <div class="resumen-section">
                <h4>üöó Carreras Realizadas</h4>
                <div class="resumen-detail"><span>Total carreras:</span> <span id="resumenCarreras"></span></div>
                <div id="resumenPlataformas"></div>
            </div>
            <div class="resumen-section">
                <h4>üí∞ Resumen Financiero</h4>
                <div class="resumen-detail"><span>Total bruto:</span> <span id="resumenTotalBruto"></span></div>
                <div class="resumen-detail"><span>Total neto:</span> <span id="resumenTotalNeto"></span></div>
                <div class="resumen-detail total"><span>Ganancia final:</span> <span id="resumenGananciaFinal"></span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn save" id="compartirResumen">Compartir</button>
                <button class="modal-btn cancel" id="cerrarResumen">Cerrar Jornada</button>
            </div>
        </div>
    </div>


    <!-- ===== TOAST ===== -->
    <div class="toast" id="toast"></div>


    <!-- ===== FIREBASE SDK (compat v9) ===== -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- ===== SCRIPTS (orden de dependencias) ===== -->
    <script src="js/firebase-config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/state.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/carreras.js"></script>
    <script src="js/gastos.js"></script>
    <script src="js/historico.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/firestore.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>

    <!-- Arreglo: mostrar mensaje de error de auth solo si hay texto -->
    <script>
        const _authError = document.getElementById('authError');
        const _origSetter = Object.getOwnPropertyDescriptor(HTMLElement.prototype, 'textContent').set;
        new MutationObserver(() => {
            _authError.style.display = _authError.textContent.trim() ? 'block' : 'none';
        }).observe(_authError, { childList: true, characterData: true, subtree: true });
    </script>

</body>

</html>